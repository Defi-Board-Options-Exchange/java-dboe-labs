define stream serv_fx_inst_event (underlying string, currency string, tick_size double);
define stream serv_security_inst_event (ticker string, currency string, tick_size double);
define stream serv_fut_inst_event (underlying string, market string, expiry_date int, multiplier int, currency string, tick_size double, alias_inst_id string);

define stream fx_rate_event (currency string, rate double);

@name('FxInstEvent')
from serv_fx_inst_event
select
  Calculator.getInstID(underlying, currency) as inst_id,
  '' as alias_inst_id,
  Calculator.getFXType() as inst_type,
  underlying,
  '' as market,
  0 as expiry_date,
  1 as multiplier,
  currency,
  tick_size,
  currentTimeMillis() as timestamp
insert into InstEvent;

@name('SecurityInstEvent')
from serv_security_inst_event
select
  ticker as inst_id,
  '' as alias_inst_id,
  Calculator.getFXType() as inst_type,
  ticker as underlying,
  '' as market,
  0 as expiry_date,
  1 as multiplier,
  currency,
  tick_size,
  currentTimeMillis() as timestamp
insert into InstEvent;

@name('FutureInstEvent')
from serv_fut_inst_event
select
  Calculator.getInstID(underlying, market, expiry_date, multiplier, currency) as inst_id,
  alias_inst_id,
  Calculator.getFutureType() as inst_type,
  underlying,
  market,
  expiry_date,
  multiplier,
  currency,
  tick_size,
  currentTimeMillis() as timestamp
insert into InstEvent;